(function(){function Complex(e,t,n,r){var i=this instanceof Complex,s=i?this:new Complex(e,t,n,r);if(!i)return s;s.m=typeof n=="number"?Math.abs(n):Math.sqrt(e*e+t*t);if(typeof r=="number"){s.t=n>=0?r:r+PI}else{s.t=Math.atan2(t,e)}s.t=PI-(PI*3-(PI-(PI*3-s.t)%(PI*2)))%(PI*2);s.r=e;s.i=t}var root=this,Math=root.Math;Math.sinh=function(e){return(-Math.exp(-e)+Math.exp(e))/2};Math.cosh=function(e){return(Math.exp(-e)+Math.exp(e))/2};var floor=function(e){return e>=0?e-e%1:e-(e%1+1)},round=function(e){e+=.5;return e>=0?e-e%1:e-(e%1+1)},ceil=function(e){return e>=0?e-(e%1+1):e-e%1},PI=Math.PI,g=7,index=[],p=[.9999999999998099,676.5203681218851,-1259.1392167224028,771.3234287776531,-176.6150291621406,12.507343278686905,-.13857109526572012,9984369578019572e-21,1.5056327351493116e-7].map(function(e,t){index.push(Complex(t,0,t,0));return Complex(e,0,Math.abs(e),e<0?PI:0)}),SQRT2PI=Complex(Math.sqrt(2*PI),0,Math.sqrt(2*PI),0);Complex.prototype.toString=function(e){return e?this.r.toPrecision().toUpperCase()+(this.i>=0?"+":"")+this.i.toPrecision().toUpperCase()+" i":this.m.toPrecision().toUpperCase()+"*e^("+this.t.toPrecision().toUpperCase()+"*i)"};Complex.exp=function(e){return e.i==0?Complex["E"].pow(e.r):Complex.Polar(Math.exp(e.r),e.i)};Complex.Polar=function(e,t){return new Complex(e*Math.cos(t),e*Math.sin(t),e,t)};Complex.prototype.add=function(e){return Complex(this.r+e.r,this.i+e.i)};Complex.prototype.sub=function(e){return Complex(this.r-e.r,this.i-e.i)};Complex.floor=function(e){return Complex(floor(e.r),floor(e.i))};Complex.ceil=function(e){return Complex(ceil(e.r),ceil(e.i))};Complex.conj=function(e){return Complex(e.r,-e.i,e.m,(PI*2-e.t)%PI*2)};Complex.prototype.mult=function(e){return Complex.Polar(this.m*e.m,this.t+e.t)};Complex.prototype.divBy=function(e){return Complex.Polar(this.m/e.m,this.t-e.t)};Complex.square=function(e){return Complex(e.r*e.r-e.i*e.i,2*e.r*e.i,e.m*e.m,e.t*2)};Complex.cube=function(e){return Complex(e.r*e.r*e.r-3*e.r*e.i*e.i,3*e.r*e.r*e.i-e.i*e.i*e.i,e.m*e.m*e.m,e.t*3)};Complex.prototype.pow=function(e){if(e==2)return Complex.square(this);if(e==3)return Complex.cube(this);return Complex.Polar(Math.pow(this.m,e),this.t*e)};Complex.sqrt=function(e){return e.pow(.5)};Complex.cbrt=function(e){return e.pow(1/3)};Complex.prototype.cPow=function(e){return e.i==0?this.pow(e.r):Complex.Polar(Math.pow(this.m,e.r)*Math.exp(-e.i*this.t),e.i*Math.log(this.m)+e.r*this.t)};Complex.gamma=function(e){if(e.r<.5)return Complex["PI"].divBy(Complex.sin(Complex["PI"].mult(e)).mult(Complex.gamma(Complex["1"].sub(e))));else{var t=e.sub(Complex["1"]),n=p[0],r;for(r=1;r<g+2;r++)n=n.add(p[r].divBy(t.add(index[r])));var i=t.add(Complex(g+.5,0,g+.5,0));return SQRT2PI.mult(i.cPow(t.add(Complex(.5,0,.5,0)))).mult(Complex.exp(Complex.neg(i))).mult(n)}};Complex.fact=function(e){return Complex.gamma(e.add(Complex["1"]))};Complex.cos=function(e){var t=e.mult(Complex["I"]);return Complex.exp(t).add(Complex.exp(Complex.neg(t))).divBy(Complex["2"])};Complex.sin=function(e){var t=e.mult(Complex["I"]);return Complex.exp(t).sub(Complex.exp(Complex.neg(t))).divBy(Complex["2I"])};Complex.tan=function(e){var t=e.mult(Complex["I"]),n=Complex.exp(t),r=Complex.exp(Complex.neg(t));return n.sub(r).divBy(n.add(r).mult(Complex["I"]))};Complex.sec=function(e){var t=e.mult(Complex["I"]);return Complex["2"].divBy(Complex.exp(t).add(Complex.exp(Complex.neg(t))))};Complex.csc=function(e){var t=e.mult(Complex["I"]);return Complex["2I"].divBy(Complex.exp(t).sub(Complex.exp(Complex.neg(t))))};Complex.cot=function(e){var t=e.mult(Complex["I"]),n=Complex.exp(t),r=Complex.exp(Complex.neg(t));return n.add(r).mult(Complex["I"]).divBy(n.sub(r))};Complex.log=function(e){return Complex(Math.log(e.m),e.t)};Complex.arcsin=function(e){return Complex["-I"].mult(Complex.log(Complex["I"].mult(e).add(Complex.sqrt(Complex["1"].sub(e.pow(2))))))};Complex.arccos=function(e){return Complex["I"].mult(Complex.log(e.add(Complex["-I"].mult(Complex.sqrt(Complex["1"].sub(e.pow(2)))))))};Complex.arctan=function(e){var t=Complex["I"];return t.mult(Complex.log(t.add(e).divBy(t.sub(e)))).divBy(Complex["2"])};Complex.arcsec=function(e){return Complex["-I"].mult(Complex.log(e.pow(-1).add(Complex.sqrt(Complex["1"].sub(Complex["I"].divBy(e.pow(2)))))))};Complex.arccsc=function(e){return Complex["-I"].mult(Complex.log(Complex["I"].divBy(e).add(Complex.sqrt(Complex["1"].sub(e.pow(-2))))))};Complex.arccot=function(e){var t=Complex["I"];return t.mult(Complex.log(e.sub(t).divBy(e.add(t)))).divBy(Complex["2"])};Complex.sinh=function(e){return Complex.exp(e).sub(Complex.exp(Complex.neg(e))).divBy(Complex["2"])};Complex.cosh=function(e){return Complex.exp(e).add(Complex.exp(Complex.neg(e))).divBy(Complex["2"])};Complex.tanh=function(e){var t=Complex.exp(e),n=Complex.exp(Complex.neg(e));return t.sub(n).divBy(t.add(n))};Complex.csch=function(e){return Complex["2"].divBy(Complex.exp(e).sub(Complex.exp(Complex.neg(e))))};Complex.sech=function(e){return Complex["2"].divBy(Complex.exp(e).add(Complex.exp(Complex.neg(e))))};Complex.coth=function(e){var t=Complex.exp(e),n=Complex.exp(Complex.neg(e));return t.add(n).divBy(t.sub(n))};Complex.arcsinh=function(e){return Complex.log(e.add(Complex.sqrt(e.pow(2).add(Complex["1"]))))};Complex.arccosh=function(e){return Complex.log(e.add(Complex.sqrt(e.pow(2).sub(Complex["1"]))))};Complex.arctanh=function(e){return Complex.log(Complex["1"].add(e).divBy(Complex["1"].sub(e))).divBy(Complex["2"])};Complex.arcsech=function(e){return Complex.log(Complex["1"].add(Complex.sqrt(Complex["1"].sub(e.pow(2)))).divBy(e))};Complex.arccsch=function(e){return Complex.log(Complex["1"].add(Complex.sqrt(Complex["1"].add(e.pow(2)))).divBy(e))};Complex.arccoth=function(e){return Complex.log(e.add(Complex["1"]).divBy(e.sub(Complex["1"]))).divBy(Complex["2"])};Complex.neg=function(e){return Complex(-e.r,-e.i,e.m,e.t+PI)};Complex.re=function(e){return Complex(e.r,0,Math.abs(e.r),e.r<0?PI:0)};Complex.im=function(e){return Complex(e.i,0,Math.abs(e.i),e.i<0?PI:0)};Complex.abs=function(e){return Complex(e.m,0,e.m,0)};Complex.arg=function(e){return Complex(e.t,0,e.t,0)};Complex.round=function(e){return Complex(round(e.r),round(e.i))};Complex.fPart=function(e){return Complex(e.r-floor(e.r),e.i-floor(e.i))};Complex.prototype.mod=function(e){return Complex(e.r===0?0:this.r%e.r,e.i===0?0:this.i%e.i)};Complex.min=function(){var e=Array.prototype.slice.call(arguments).map(function(e){return e.m}),t=Math.min.apply(Math,e);return arguments[e.indexOf(t)]};Complex.max=function(){var e=Array.prototype.slice.call(arguments).map(function(e){return e.m}),t=Math.max.apply(Math,e);return arguments[e.indexOf(t)]};Complex.isNaN=function(e){return isNaN(e.r)||isNaN(e.i)||isNaN(e.m)||isNaN(e.t)};Complex.isFinite=function(e){return isFinite(e.m)};Complex.parseFunction=function(str,args,skipFormat){with(this){var vars=generate(args=args||[]);str=str.toLowerCase();if(!skipFormat)str=formatFunction(str);var namespace=new Namespace;return(new Function(args.map(function(e){return vars[e]}).join(","),"return "+function compile(e){var t=compile,n="",r=0,i=0;while(r<e.length){if(i!=2&&e.substr(r,2)!="e^"&&e.substr(r).search(varsExp)==0){var s=e.substr(r).match(varsExp)[0],o=varsObj[s]||vars[s];if(!o)throw'"'+s+'" is not a valid variable.';n+=o;r+=s.length;i=2;continue}if(i!=2&&e.substr(r).search(funcExp)==0){var s=e.substr(r).match(funcExp)[0],u=funcObj[s],a=s=="-"?nextAddSub(e,r+s.length):s=="e^"?nextPower(e,r+s.length):endNest(e,r+s.length);if(!u){s=s.substr(0,s.length-1);if(!(varsObj[s]||vars[s]))throw'"'+s+'(" is not a valid function.';e=e.substr(0,r)+s+"*("+e.substr(r+s.length+1);continue}n+=u=="("?"":u;r+=s.length;n+=t(e.substring(r,a))+(u=="("?"":")");r=e[a]==")"?a+1:a;i=2;continue}if(i==2&&e.substr(r).search(operExp)==0){var s=e.substr(r).match(operExp)[0],f=operObj[s],l=e.substr(r+1).search(numsExp)==0&&e.substr(r+1).match(numsExp)[0],a=nextOperator(s,e,r+s.length+(l?l.length:0));if(!f)throw'"'+s+'" is not a valid operator.';n+=f;r+=s.length;n+=t(e.substring(r,a))+")";r=e[a]==")"?a+1:a;i=2;continue}if(i!=2&&e.substr(r).search(numsExp)==0){var s=e.substr(r).match(numsExp)[0],c=parseFloat(s);if(isNaN(c))throw'"'+s+'" is not a valid number.';n+="this.array["+namespace.addComplex(Complex(c,0,c,0))+"]";r+=s.length;i=2;continue}throw'Unexpected character "'+e.charAt(r)+'".'}return n}(str)+";")).bind(namespace)}};Complex.parseFunction=Complex.parseFunction.bind(function(){var e=/(?:\d[a-z\{\[\(]|[\}\]\)][a-z\d])|(?:[\{\}\[\]]| *[\+\-\*\/\^ %] *)/gi,t=/[a-z]*\(|(?:-|e\^)(?:\(|)/,n=/[a-z]+(?![a-z]*\()/,r=/[\+\-\*\/\^ %]/,i=/(?:(?:\d*\.\d+|\d+\.\d*)|\d+)(?:e(?:-|)\d+|)/,s={"cos(":"this.Complex.cos(","sin(":"this.Complex.sin(","tan(":"this.Complex.tan(","sec(":"this.Complex.sec(","csc(":"this.Complex.csc(","cot(":"this.Complex.cot(","log(":"this.Complex.log(","ln(":"this.Complex.log(","gamma(":"this.Complex.gamma(","fact(":"this.Complex.fact(","factorial(":"this.Complex.fact(","(":"(","e^":"this.Complex.exp(","e^(":"this.Complex.exp(","arccos(":"this.Complex.arccos(","arcsin(":"this.Complex.arcsin(","arctan(":"this.Complex.arctan(","arcsec(":"this.Complex.arcsec(","arccsc(":"this.Complex.arccsc(","arccot(":"this.Complex.arccot(","acos(":"this.Complex.arccos(","asin(":"this.Complex.arcsin(","atan(":"this.Complex.arctan(","asec(":"this.Complex.arcsec(","acsc(":"this.Complex.arccsc(","acot(":"this.Complex.arccot(","-":"this.Complex.neg(","-(":"this.Complex.neg(","cosh(":"this.Complex.cosh(","sinh(":"this.Complex.sinh(","tanh(":"this.Complex.tanh(","sech(":"this.Complex.sech(","csch(":"this.Complex.csch(","coth(":"this.Complex.coth(","re(":"this.Complex.re(","im(":"this.Complex.im(","abs(":"this.Complex.abs(","arg(":"this.Complex.arg(","conj(":"this.Complex.conj(","int(":"this.Complex.floor(","floor(":"this.Complex.floor(","ceil(":"this.Complex.ceil(","round(":"this.Complex.round(","fpart(":"this.Complex.fPart(","ipart(":"this.Complex.floor(","sqrt(":"this.Complex.sqrt(","cbrt(":"this.Complex.cbrt(","arccosh(":"this.Complex.arccosh(","arcsinh(":"this.Complex.arcsinh(","arctanh(":"this.Complex.arctanh(","arcsech(":"this.Complex.arcsech(","arccsch(":"this.Complex.arccsch(","arccoth(":"this.Complex.arccoth(","arcosh(":"this.Complex.arccosh(","arsinh(":"this.Complex.arcsinh(","artanh(":"this.Complex.arctanh(","arsech(":"this.Complex.arcsech(","arcsch(":"this.Complex.arccsch(","arcoth(":"this.Complex.arccoth(","acosh(":"this.Complex.arccosh(","asinh(":"this.Complex.arcsinh(","atanh(":"this.Complex.arctanh(","asech(":"this.Complex.arcsech(","acsch(":"this.Complex.arccsch(","acoth(":"this.Complex.arccoth(","exp(":"this.Complex.exp("},o={"+":".add(","-":".sub(","*":".mult("," ":".mult(","/":".divBy(","^":".cPow(","%":".mod("},u={e:"this.Complex.E",i:"this.Complex.I",pi:"this.Complex.PI"},a=function(t){var n=/\{|\[/,r=/\}|\]/,i=/\d[a-z\{\[\(]|[\}\]\)][a-z\d]/i,s=/^\de(?:-|)\d+/i,o=/[\+\-\*\/\^%]/;return t.replace(e,function u(a,f){if(i.test(a)){if(s.test(t.slice(f)))return a;return a.charAt(0).replace(e,u)+"*"+a.charAt(1).replace(e,u)}else if(n.test(a)){return"("}else if(r.test(a)){return")"}else{var l=a.search(o);return a.charAt(l!=-1?l:"*")}})},f=function(e){var t=/[^a-z]+/i;e=e.map(function(e){var n=e.replace(t,"");if(!n)throw'"'+e+'" is an invalid variable name. Only "a" through "z" are accepted within names. "e", "i" and "pi", will be calculated as the constants.';return n.toLowerCase()});var n="abcdefghijklmnopqrstuvwxyz",r=n.length,i={},s="",o,u;for(var a=0;a<e.length;a++){o=a;while(o>=0){u=o%r;o=o-u;s=n.charAt(u)+s;o=o/r-1}i[e[a]]=s;s=""}return i},l=function(e,t){var n=1;while(e[t]=="("?n++:e[t]==")"?--n:t<e.length)t++;return t},c=function(e,t){var n=0;for(var r=t;r<e.length;r++){if(e[r]=="(")n++;else if(e[r]==")")n--;if(n<0)return r;else if(n==0){if(e[r]=="+"||e[r]=="-"&&!o[e[r-1]])return r}}return e.length},h=function(e,t){var n=0;for(var r=t;r<e.length;r++){if(e[r]=="(")n++;else if(e[r]==")")n--;if(n<0)return r;else if(n==0){if(e[r]=="+"||e[r]=="-"&&!o[e[r-1]])return r;if(e[r]=="*"||e[r]=="/"||e[r]==" "||e[r]=="%")return r}}return e.length},p=function(e,t){var n=0;for(var r=t;r<e.length;r++){if(e[r]=="(")n++;else if(e[r]==")")n--;if(n<0)return r;else if(n==0){if(e[r]=="+"||e[r]=="-"&&e[r-1]!="^")return r;if(e[r]=="*"||e[r]=="/"||e[r]==" "||e[r]=="%")return r;if(e[r]=="^")return r}}return e.length},d=function(e,t,n){switch(e){case"+":case"-":return c(t,n);case"*":case"/":case" ":case"%":return h(t,n);case"^":return p(t,n);default:throw'"'+e+'" is not a valid operator.'}},v=function(){var e=this;e.array=[];e.Complex=Complex;e.addComplex=function(t){e.array.push(t);return e.array.length-1}};Complex.formatFunction=a;return{funcExp:t,varsExp:n,operExp:r,numsExp:i,funcObj:s,varsObj:u,operObj:o,generate:f,formatFunction:a,endNest:l,nextAddSub:c,nextMultDiv:h,nextPower:p,nextOperator:d,Namespace:v}}());Complex["0"]=Complex(0,0,0,0);Complex["1"]=Complex(1,0,1,0);Complex["I"]=Complex(0,1,1,PI/2);Complex["-I"]=Complex(0,-1,1,3*PI/2);Complex["PI"]=Complex(PI,0,PI,0);Complex["E"]=Complex(Math.E,0,Math.E,0);Complex["2"]=Complex(2,0,2,0);Complex["2I"]=Complex(0,2,2,PI/2);if(typeof module!=="undefined"&&module.exports)module.exports=Complex;else root.Complex=Complex})()